<!DOCTYPE html><html lang="zh" data-theme-enabled="1"><head><script>window.currentUser = null;</script><script>window.rateUsdToNative = 6.3589;</script><title itemprop="name">冒泡和捕获</title><link href="../pack/styles.e61986aaa5d558f47fd2.css" rel="stylesheet"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes, minimum-scale=1.0"><meta name="apple-mobile-web-app-capable" content="yes"><!-- chrome autotranslate is enabled only for "en" main version--><meta name="google" content="notranslate"><script>if (window.devicePixelRatio > 1) document.cookie = 'pixelRatio=' + window.devicePixelRatio + ';path=/;expires=Tue, 19 Jan 2038 03:14:07 GMT';</script><link href="//fonts.googleapis.com/css?family=Open+Sans:bold,italic,bolditalic" rel="stylesheet"><link rel="apple-touch-icon-precomposed" href="../img/favicon/apple-touch-icon-precomposed.png"><link rel="canonical" href="https://zh.javascript.info/bubbling-and-capturing"><meta name="msapplication-TileColor" content="#222A2C"><meta name="msapplication-TileImage" content="/img/favicon/tileicon.png"><link rel="icon" href="../img/favicon/favicon.png"><meta itemprop="image" content="https://zh.javascript.info/img/site_preview_en_512x512.png"><meta property="og:title" content="冒泡和捕获"><meta property="og:image" content="../img/site_preview_en_1200x630.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="fb:admins" content="100001562528165"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="冒泡和捕获"><meta name="twitter:site" content="@iliakan"><meta name="twitter:creator" content="@iliakan"><meta name="twitter:image" content="https://zh.javascript.info/img/site_preview_en_512x512.png"><link rel="prev" href="/introduction-browser-events"><link rel="next" href="/event-delegation"><script>window.GA_ID = "UA-2056213-15";</script><script>window.YANDEX_METRIKA_ID = 65598091;</script><script>window.GoogleAnalyticsObject="ga",window.ga=function(){window.ga.q.push(arguments)},window.ga.q=[],window.ga.l=Date.now(),ga("create",GA_ID,"auto"),window.GTM_ID&&ga("require",GTM_ID),window.currentUser?ga("set","&uid",currentUser.id):ga("set","anonymizeIp",!0),window.addEventListener("error",function(e){var r=(e.filename||e.errorUrl)+": "+(e.lineno||e.errorLine),n=e.stack||e.error&&e.error.stack;ga("send","exception",{exDescription:e.message+" "+r+" "+n,exFatal:!0})});</script><script src="https://www.google-analytics.com/analytics.js" async></script><script>ga('send', 'pageview');</script><script>window.metrika={reachGoal:function(){}},window.yandex_metrika_callbacks=[function(){try{window.metrika=new Ya.Metrika({id:YANDEX_METRIKA_ID,webvisor:!0,clickmap:!0,params:{user:window.currentUser&&window.currentUser.id}}),metrika.trackLinks({delay:150}),window.addEventListener("error",function(r){window.metrika.reachGoal("JSERROR",{src:(r.filename||r.errorUrl)+": "+(r.lineno||r.errorLine),stack:r.stack||r.error&&r.error.stack,message:r.message})})}catch(r){}}];</script><script src="//mc.yandex.ru/metrika/watch.js" async></script><script>window.RECAPTCHA_ID = "6LfmLAEVAAAAAJMykMnf7aY8nkyTRmYi2ynx51R1";</script><script src="../pack/init.f551d10c469632252be6.js"></script><script src="../pack/head.7c4dbce7f0d4e5d1865e.js" defer></script><meta property="og:title" content="冒泡和捕获"><meta property="og:type" content="article"><script src="../pack/tutorial.0085805d53a665cf3a7e.js" defer></script><script src="../pack/footer.b5edaae5b6e4efe79394.js" defer></script></head><body class="no-icons"><script>window.fontTest();</script><div class="page-wrapper page-wrapper_sidebar_on"><!--[if IE]><div style="color:red;text-align:center">很抱歉，我们不支持 Internet Explorer 等浏览器，请使用一个更新版本的浏览器。</div><![endif]--><div class="sitetoolbar sitetoolbar_tutorial"><script>window.langs = [{"code":"ar","name":"Arabic"},{"code":"az","name":"Azerbaijani"},{"code":"bg","name":"Bulgarian"},{"code":"bn","name":"Bengali"},{"code":"bs","name":"Bosnian"},{"code":"ca","name":"Catalan"},{"code":"cs","name":"Czech"},{"code":"da","name":"Danish"},{"code":"de","name":"German"},{"code":"el","name":"Greek"},{"code":"en","name":"English"},{"code":"es","name":"Spanish"},{"code":"fa","name":"Persian (Farsi)"},{"code":"fi","name":"Finnish"},{"code":"fr","name":"French"},{"code":"he","name":"Hebrew"},{"code":"hi","name":"Hindi"},{"code":"hr","name":"Croatian"},{"code":"hu","name":"Hungarian"},{"code":"hy","name":"Armenian"},{"code":"id","name":"Indonesian"},{"code":"it","name":"Italian"},{"code":"ja","name":"Japanese"},{"code":"ka","name":"Georgian"},{"code":"kk","name":"Kazakh"},{"code":"km","name":"Central Khmer"},{"code":"ko","name":"Korean"},{"code":"lt","name":"Lithuanian"},{"code":"me","name":"Montenegrin"},{"code":"ml","name":"Malayalam"},{"code":"my","name":"Burmese"},{"code":"nl","name":"Dutch"},{"code":"no","name":"Norvegian"},{"code":"pa","name":"Punjabi"},{"code":"pl","name":"Polish"},{"code":"pt","name":"Portuguese"},{"code":"ro","name":"Romanian"},{"code":"ru","name":"Russian"},{"code":"si","name":"Sinhala"},{"code":"sk","name":"Slovak"},{"code":"sl","name":"Slovenian"},{"code":"sq","name":"Albanian"},{"code":"sr","name":"Serbian"},{"code":"ta","name":"Tamil"},{"code":"te","name":"Telugu"},{"code":"test","name":"Test"},{"code":"th","name":"Thai"},{"code":"tk","name":"Turkmen"},{"code":"tr","name":"Turkish"},{"code":"uk","name":"Ukrainian"},{"code":"ur","name":"Urdu"},{"code":"uz","name":"Uzbek"},{"code":"v2","name":"v2"},{"code":"vi","name":"Vietnamese"},{"code":"zh-hant","name":"Chinese Traditional"},{"code":"zh","name":"Chinese"}];</script><script>window.lang = "zh";</script><script>{let t=navigator.languages||[];t=t.map(t=>t.toLowerCase());let o,i,n=[];for(let o of window.langs)for(let i of t)if(i===o.code||i.startsWith(o.code+"-")){n.push(o);break}if(!o&&"ru"!=lang&&"en"!=lang){n.find(t=>"en"==t.code)&&(o=`\n            According to your browser headers, you know English. Please help to <a href="https://github.com/javascript-tutorial/${lang}.javascript.info#readme">translate the tutorial</a>.\n            Thank you!\n          `,i="notify-translate-tutorial-local")}if(o){let t=`<div class="notification notification_top notification_info sitetoolbar__notification" style="display:none" id="${i}">\n          <div class="notification__content">${o}</div>\n          <button class="notification__close" title="Close"></button>\n        </div>`;document.write(t),showTopNotification()}}</script><div class="sitetoolbar__content"><div class="sitetoolbar__lang-switcher"><button class="sitetoolbar__dropdown-button" data-dropdown-toggler>ZH</button><div class="sitetoolbar__dropdown-wrap"><div class="sitetoolbar__dropdown-body"><div class="sitetoolbar__lang-switcher-body"><div class="supported-langs supported-langs_toolbar"><div class="supported-langs__container"><ul class="supported-langs__list" style="height:200px"><li class="supported-langs__item"><a class="supported-langs__link" href="https://ar.javascript.info/bubbling-and-capturing"><span class="supported-langs__brief">AR</span><span class="supported-langs__title">عربي</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://javascript.info/bubbling-and-capturing"><span class="supported-langs__brief">EN</span><span class="supported-langs__title">English</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://es.javascript.info/bubbling-and-capturing"><span class="supported-langs__brief">ES</span><span class="supported-langs__title">Español</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://fr.javascript.info/"><span class="supported-langs__brief">FR</span><span class="supported-langs__title">Français</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://id.javascript.info/bubbling-and-capturing"><span class="supported-langs__brief">ID</span><span class="supported-langs__title">Indonesia</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://it.javascript.info/bubbling-and-capturing"><span class="supported-langs__brief">IT</span><span class="supported-langs__title">Italiano</span></a></li></ul><ul class="supported-langs__list" style="height:200px"><li class="supported-langs__item"><a class="supported-langs__link" href="https://ja.javascript.info/bubbling-and-capturing"><span class="supported-langs__brief">JA</span><span class="supported-langs__title">日本語</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://ko.javascript.info/bubbling-and-capturing"><span class="supported-langs__brief">KO</span><span class="supported-langs__title">한국어</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://learn.javascript.ru/bubbling-and-capturing"><span class="supported-langs__brief">RU</span><span class="supported-langs__title">Русский</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://tr.javascript.info/bubbling-and-capturing"><span class="supported-langs__brief">TR</span><span class="supported-langs__title">Türkçe</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://uk.javascript.info/"><span class="supported-langs__brief">UK</span><span class="supported-langs__title">Українська</span></a></li><li class="supported-langs__item supported-langs__item_current"><a class="supported-langs__link" href="index.html"><span class="supported-langs__brief">ZH</span><span class="supported-langs__title">简体中文</span></a></li></ul></div><div class="supported-langs__text">我们希望将这个开源项目提供给全世界的人。请帮助我们将教程的内容 <a href="https://github.com/javascript-tutorial/translate" rel="noopener noreferrer" target="_blank">翻译为你所掌握的语言</a> 对应的版本。</div></div></div></div></div></div><div class="sitetoolbar__logo-wrap"><a class="sitetoolbar__link sitetoolbar__link_logo" href="../index.html"><img class="sitetoolbar__logo sitetoolbar__logo_normal" src="../img/sitetoolbar__logo_en.svg" width="200" alt role="presentation"><img class="sitetoolbar__logo sitetoolbar__logo_normal sitetoolbar__logo_dark" src="../img/sitetoolbar__logo_en-white.svg" width="200" alt role="presentation"><img class="sitetoolbar__logo sitetoolbar__logo_small" src="../img/sitetoolbar__logo_small_en.svg" width="70" alt role="presentation"><img class="sitetoolbar__logo sitetoolbar__logo_small sitetoolbar__logo_dark" src="../img/sitetoolbar__logo_small_en-white.svg" width="70" alt role="presentation"><script>Array.prototype.forEach.call(document.querySelectorAll("img.sitetoolbar__logo"),function(e){let t=document.createElement("object");t.type="image/svg+xml",t.className=e.className,t.style.cssText="left:0;top:0;position:absolute",t.onload=function(){t.onload=null,e.style.visibility="hidden"},t.data=e.src,e.parentNode.insertBefore(t,e)});</script></a></div><div class="sitetoolbar__nav-toggle-wrap"><button class="sitetoolbar__nav-toggle" type="button"></button></div><nav class="sitetoolbar__sections"><ul class="sitetoolbar__sections-list"></ul></nav><div class="sitetoolbar__book-wrap"><a class="buy-book-button" href="../ebook/index.html"><span class="buy-book-button__extra-text">购买</span>EPUB/PDF</a></div><div class="sitetoolbar__theme-switcher"><div class="theme-changer"><label class="theme-changer__label" for="theme-changer-input" data-tooltip="Change theme"><input class="theme-changer__input" type="checkbox" id="theme-changer-input" data-theme-changer="data-theme-changer"><span class="theme-changer__icon theme-changer__icon_light-theme"></span><span class="theme-changer__icon theme-changer__icon_dark-theme"></span></label></div></div><div class="sitetoolbar__search-wrap"><div class="sitetoolbar__search-content"><button class="sitetoolbar__search-toggle" type="button"></button><form class="sitetoolbar__search" method="GET" action="/search"><div class="sitetoolbar__search-input"><div class="text-input"><input class="text-input__control" name="query" placeholder="在 Javascript.info 网站中搜索" required="required" type="text"></div><button class="sitetoolbar__find" type="submit">搜索</button></div></form></div></div></div><div class="tablet-menu"><div class="tablet-menu__line"><div class="tablet-menu__content"><form class="tablet-menu-search" action="/search/"><input class="tablet-menu-search__input" type="search" name="query" placeholder="在教程中搜索" required="required"><button class="tablet-menu-search__button" type="submit" name="type" value="articles">搜索</button></form></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><a class="map" href="../tutorial/map/index.html" data-action="tutorial-map"><span class="map__text">教程路线图</span></a></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><div class="theme-changer theme-changer_tablet-menu theme-changer_has-label"><label class="theme-changer__label" for="theme-changer-input-tablet" data-tooltip="Change theme"><input class="theme-changer__input" type="checkbox" id="theme-changer-input-tablet" data-theme-changer="data-theme-changer"><span class="theme-changer__icon theme-changer__icon_light-theme"></span><span class="theme-changer__icon theme-changer__icon_dark-theme"></span><span class="theme-changer__label-text theme-changer__label-text_light-theme">Light theme</span><span class="theme-changer__label-text theme-changer__label-text_dark-theme">Dark theme</span></label></div></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><div class="share-icons"><span class="share-icons__title">分享</span><a class="share share_tw" href="https://twitter.com/share?url=https%3A%2F%2Fzh.javascript.info%2Fbubbling-and-capturing" rel="nofollow"></a><a class="share share_fb" href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=https%3A%2F%2Fzh.javascript.info%2Fbubbling-and-capturing" rel="nofollow"></a></div></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><select class="tablet-menu__nav input-select input-select input-select_small" onchange="if(this.value) window.location.href=this.value"><option value="https://ar.javascript.info/bubbling-and-capturing">عربي</option><option value="https://javascript.info/bubbling-and-capturing">English</option><option value="https://es.javascript.info/bubbling-and-capturing">Español</option><option value="https://fr.javascript.info/">Français</option><option value="https://id.javascript.info/bubbling-and-capturing">Indonesia</option><option value="https://it.javascript.info/bubbling-and-capturing">Italiano</option><option value="https://ja.javascript.info/bubbling-and-capturing">日本語</option><option value="https://ko.javascript.info/bubbling-and-capturing">한국어</option><option value="https://learn.javascript.ru/bubbling-and-capturing">Русский</option><option value="https://tr.javascript.info/bubbling-and-capturing">Türkçe</option><option value="https://uk.javascript.info/">Українська</option><option value="https://zh.javascript.info/bubbling-and-capturing" selected>简体中文</option></select></div></div></div><progress class="tutorial-progress" data-sticky value="13" max="32" data-tooltip="第 13/32 节"></progress></div><div class="page page_sidebar_on page_inner_padding"><script>if(localStorage.noSidebar){document.querySelector(".page").classList.remove("page_sidebar_on");let e=document.querySelector(".page-wrapper");e&&e.classList.remove("page-wrapper_sidebar_on")}setTimeout(function(){document.querySelector(".page").classList.add("page_sidebar-animation-on")});</script><div class="page__inner"><main class="main main_width-limit"><header class="main__header"><div class="main__header-inner"><div class="main__header-group"><ol class="breadcrumbs"><li class="breadcrumbs__item breadcrumbs__item_home"><a class="breadcrumbs__link" href="../index.html"><span class="breadcrumbs__hidden-text">教程</span></a></li><li class="breadcrumbs__item" id="breadcrumb-1"><a class="breadcrumbs__link" href="../ui/index.html"><span>浏览器：文档，事件，接口</span></a></li><li class="breadcrumbs__item" id="breadcrumb-2"><a class="breadcrumbs__link" href="../events/index.html"><span>事件简介</span></a></li><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"教程","item":"https://zh.javascript.info/"},{"@type":"ListItem","position":2,"name":"浏览器：文档，事件，接口","item":"https://zh.javascript.info/ui"},{"@type":"ListItem","position":3,"name":"事件简介","item":"https://zh.javascript.info/events"}]}</script></ol><div class="updated-at" data-tooltip="最后修改在 15日 十二月 2021"><div class="updated-at__content">15日 十二月 2021</div></div></div><h1 class="main__header-title">冒泡和捕获</h1></div></header><div class="content"><article class="formatted" itemscope itemtype="http://schema.org/TechArticle"><meta itemprop="name" content="冒泡和捕获"><div itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="email" content="iliakan@gmail.com"><meta itemprop="name" content="Ilya Kantor"></div><div itemprop="articleBody"><p>让我们从一个示例开始。</p>
<p>处理程序（handler）被分配给了 <code>&lt;div&gt;</code>，但是如果你点击任何嵌套的标签（例如 <code>&lt;em&gt;</code> 或 <code>&lt;code&gt;</code>），该处理程序也会运行：</p>
<div id="5q309b6kpr" data-trusted="1" class="code-example" data-demo-height="60" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code>&lt;div onclick=&quot;alert('The handler!')&quot;&gt;
  &lt;em&gt;If you click on &lt;code&gt;EM&lt;/code&gt;, the handler on &lt;code&gt;DIV&lt;/code&gt; runs.&lt;/em&gt;
&lt;/div&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
          <iframe class="code-result__iframe" name="test-5q309b6kpr" style="height:60px" src="about:blank"></iframe>
        </div>
      </div><p>这是不是有点奇怪？如果实际上点击的是 <code>&lt;em&gt;</code>，为什么在 <code>&lt;div&gt;</code> 上的处理程序会运行？</p>
<h2><a class="main__anchor" name="mao-pao" href="#mao-pao">冒泡</a></h2><p>冒泡（bubbling）原理很简单。</p>
<p><strong>当一个事件发生在一个元素上，它会首先运行在该元素上的处理程序，然后运行其父元素上的处理程序，然后一直向上到其他祖先上的处理程序。</strong></p>
<p>假设我们有 3 层嵌套 <code>FORM &gt; DIV &gt; P</code>，它们各自拥有一个处理程序：</p>
<div id="rlf63m3cj4" data-trusted="1" class="code-example" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="展示" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="在沙箱中打开" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code>&lt;style&gt;
  body * {
    margin: 10px;
    border: 1px solid blue;
  }
&lt;/style&gt;

&lt;form onclick=&quot;alert('form')&quot;&gt;FORM
  &lt;div onclick=&quot;alert('div')&quot;&gt;DIV
    &lt;p onclick=&quot;alert('p')&quot;&gt;P&lt;/p&gt;
  &lt;/div&gt;
&lt;/form&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
          <iframe class="code-result__iframe" name="test-rlf63m3cj4" style="height:200px" src="about:blank"></iframe>
        </div>
      </div><p>点击内部的 <code>&lt;p&gt;</code> 会首先运行 <code>onclick</code>：</p>
<ol>
<li>在该 <code>&lt;p&gt;</code> 上的。</li>
<li>然后是外部 <code>&lt;div&gt;</code> 上的。</li>
<li>然后是外部 <code>&lt;form&gt;</code> 上的。</li>
<li>以此类推，直到最后的 <code>document</code> 对象。</li>
</ol>
<figure><div class="image" style="width:353px">
      <div class="image__ratio" style="padding-top:61.18980169971672%"></div>
      <object type="image/svg+xml" data="../article/bubbling-and-capturing/event-order-bubbling.svg" width="353" height="216" class="image__image" data-use-theme>
        <img src="../article/bubbling-and-capturing/event-order-bubbling.svg" alt width="353" height="216">
      </object>
      </div></figure><p>因此，如果我们点击 <code>&lt;p&gt;</code>，那么我们将看到 3 个 alert：<code>p</code> → <code>div</code> → <code>form</code>。</p>
<p>这个过程被称为“冒泡（bubbling）”，因为事件从内部元素“冒泡”到所有父级，就像在水里的气泡一样。</p>
<div class="important important_warn">
            <div class="important__header"><span class="important__type"><strong>几乎</strong> 所有事件都会冒泡。</span></div>
            <div class="important__content"><p>这句话中的关键词是“几乎”。</p>
<p>例如，<code>focus</code> 事件不会冒泡。同样，我们以后还会遇到其他例子。但这仍然是例外，而不是规则，大多数事件的确都是冒泡的。</p>
</div></div>
<h2><a class="main__anchor" name="eventtarget" href="#eventtarget">event.target</a></h2><p>父元素上的处理程序始终可以获取事件实际发生位置的详细信息。</p>
<p><strong>引发事件的那个嵌套层级最深的元素被称为目标元素,可以通过 <code>event.target</code> 访问。</strong></p>
<p>注意与 <code>this</code>（=<code>event.currentTarget</code>）之间的区别：</p>
<ul>
<li><code>event.target</code> —— 是引发事件的“目标”元素，它在冒泡过程中不会发生变化。</li>
<li><code>this</code> —— 是“当前”元素，其中有一个当前正在运行的处理程序。</li>
</ul>
<p>例如，如果我们有一个处理程序 <code>form.onclick</code>，那么它可以“捕获”表单内的所有点击。无论点击发生在哪里，它都会冒泡到 <code>&lt;form&gt;</code> 并运行处理程序。</p>
<p>在 <code>form.onclick</code> 处理程序中：</p>
<ul>
<li><code>this</code>（=<code>event.currentTarget</code>）是 <code>&lt;form&gt;</code> 元素，因为处理程序在它上面运行。</li>
<li><code>event.target</code> 是表单中实际被点击的元素。</li>
</ul>
<p>一探究竟：</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button class="code-tabs__scroll-button code-tabs__scroll-button_left" title="&amp;larr;" data-code-tabs-left="data-code-tabs-left"></button></div><div class="code-tabs__switches-wrap"><div class="code-tabs__switches" data-code-tabs-switches="data-code-tabs-switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">结果</div><div class="code-tabs__switch">script.js</div><div class="code-tabs__switch">example.css</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button class="code-tabs__scroll-button code-tabs__scroll-button_right" title="&amp;rarr;" data-code-tabs-right="data-code-tabs-right"></button></div><div class="code-tabs__buttons"><a class="code-tabs__button code-tabs__button_external" target="_blank" title="在新窗口中打开" href="../article/bubbling-and-capturing/bubble-target/index.html"></a><a class="code-tabs__button code-tabs__button_edit" target="_blank" title="在沙箱中编辑" href="https://plnkr.co/edit/VfyhaxsDdMxK5FOv?p=preview"></a></div></div><div class="code-tabs__content" data-code-tabs-content="data-code-tabs-content" style="height:220px"><div class="code-tabs__section code-tabs__section_current"><iframe class="code-tabs__result" src="../article/bubbling-and-capturing/bubble-target/index.html"></iframe></div><div class="code-tabs__section"><pre class="language-javascript line-numbers"><code>form.onclick = function(event) {
  event.target.style.backgroundColor = 'yellow';

  // chrome needs some time to paint yellow
  setTimeout(() =&gt; {
    alert(&quot;target = &quot; + event.target.tagName + &quot;, this=&quot; + this.tagName);
    event.target.style.backgroundColor = ''
  }, 0);
};</code></pre></div><div class="code-tabs__section"><pre class="language-css line-numbers"><code>form {
  background-color: green;
  position: relative;
  width: 150px;
  height: 150px;
  text-align: center;
  cursor: pointer;
}

div {
  background-color: blue;
  position: absolute;
  top: 25px;
  left: 25px;
  width: 100px;
  height: 100px;
}

p {
  background-color: red;
  position: absolute;
  top: 25px;
  left: 25px;
  width: 50px;
  height: 50px;
  line-height: 50px;
  margin: 0;
}

body {
  line-height: 25px;
  font-size: 16px;
}</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset=&quot;utf-8&quot;&gt;
  &lt;link rel=&quot;stylesheet&quot; href=&quot;example.css&quot;&gt;
&lt;/head&gt;

&lt;body&gt;
  A click shows both &lt;code&gt;event.target&lt;/code&gt; and &lt;code&gt;this&lt;/code&gt; to compare:

  &lt;form id=&quot;form&quot;&gt;FORM
    &lt;div&gt;DIV
      &lt;p&gt;P&lt;/p&gt;
    &lt;/div&gt;
  &lt;/form&gt;

  &lt;script src=&quot;script.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre></div></div></div><p><code>event.target</code> 可能会等于 <code>this</code> —— 当点击事件发生在 <code>&lt;form&gt;</code> 元素上时，就会发生这种情况。</p>
<h2><a class="main__anchor" name="ting-zhi-mao-pao" href="#ting-zhi-mao-pao">停止冒泡</a></h2><p>冒泡事件从目标元素开始向上冒泡。通常，它会一直上升到 <code>&lt;html&gt;</code>，然后再到 <code>document</code> 对象，有些事件甚至会到达 <code>window</code>，它们会调用路径上所有的处理程序。</p>
<p>但是任意处理程序都可以决定事件已经被完全处理，并停止冒泡。</p>
<p>用于停止冒泡的方法是 <code>event.stopPropagation()</code>。</p>
<p>例如，如果你点击 <code>&lt;button&gt;</code>，这里的 <code>body.onclick</code> 不会工作：</p>
<div id="zz61ecks96" data-trusted="1" class="code-example" data-demo-height="60" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="展示" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="在沙箱中打开" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code>&lt;body onclick=&quot;alert(`the bubbling doesn't reach here`)&quot;&gt;
  &lt;button onclick=&quot;event.stopPropagation()&quot;&gt;Click me&lt;/button&gt;
&lt;/body&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
          <iframe class="code-result__iframe" name="test-zz61ecks96" style="height:60px" src="about:blank"></iframe>
        </div>
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">event.stopImmediatePropagation()</span></div>
            <div class="important__content"><p>如果一个元素在一个事件上有多个处理程序，即使其中一个停止冒泡，其他处理程序仍会执行。</p>
<p>换句话说，<code>event.stopPropagation()</code> 停止向上移动，但是当前元素上的其他处理程序都会继续运行。</p>
<p>有一个 <code>event.stopImmediatePropagation()</code> 方法，可以用于停止冒泡，并阻止当前元素上的处理程序运行。使用该方法之后，其他处理程序就不会被执行。</p>
</div></div>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">不要在没有需要的情况下停止冒泡！</span></div>
            <div class="important__content"><p>冒泡很方便。不要在没有真实需求时阻止它：除非是显而易见的，并且在架构上经过深思熟虑的。</p>
<p>有时 <code>event.stopPropagation()</code> 会产生隐藏的陷阱，以后可能会成为问题。</p>
<p>例如：</p>
<ol>
<li>我们创建了一个嵌套菜单，每个子菜单各自处理对自己的元素的点击事件，并调用 <code>stopPropagation</code>，以便不会触发外部菜单。</li>
<li>之后，我们决定捕获在整个窗口上的点击，以追踪用户的行为（用户点击的位置）。有些分析系统会这样做。通常，代码会使用 <code>document.addEventListener('click'…)</code> 来捕获所有的点击。</li>
<li>我们的分析不适用于被 <code>stopPropagation</code> 所阻止点击的区域。太伤心了，我们有一个“死区”。</li>
</ol>
<p>通常，没有真正的必要去阻止冒泡。一项看似需要阻止冒泡的任务，可以通过其他方法解决。其中之一就是使用自定义事件，稍后我们会介绍它们此外，我们还可以将我们的数据写入一个处理程序中的 <code>event</code> 对象，并在另一个处理程序中读取该数据，这样我们就可以向父处理程序传递有关下层处理程序的信息。</p>
</div></div>
<h2><a class="main__anchor" name="bu-huo" href="#bu-huo">捕获</a></h2><p>事件处理的另一个阶段被称为“捕获（capturing）”。它很少被用在实际开发中，但有时是有用的。</p>
<p><a href="http://www.w3.org/TR/DOM-Level-3-Events/">DOM 事件</a>标准描述了事件传播的 3 个阶段：</p>
<ol>
<li>捕获阶段（Capturing phase）—— 事件（从 Window）向下走近元素。</li>
<li>目标阶段（Target phase）—— 事件到达目标元素。</li>
<li>冒泡阶段（Bubbling phase）—— 事件从元素上开始冒泡。</li>
</ol>
<p>下面是在表格中点击 <code>&lt;td&gt;</code> 的图片，摘自规范：</p>
<figure><div class="image" style="width:641px">
      <div class="image__ratio" style="padding-top:98.75195007800312%"></div>
      <object type="image/svg+xml" data="../article/bubbling-and-capturing/eventflow.svg" width="641" height="633" class="image__image" data-use-theme>
        <img src="../article/bubbling-and-capturing/eventflow.svg" alt width="641" height="633">
      </object>
      </div></figure><p>也就是说：点击 <code>&lt;td&gt;</code>，事件首先通过祖先链向下到达元素（捕获阶段），然后到达目标（目标阶段），最后上升（冒泡阶段），在途中调用处理程序。</p>
<p><strong>之前，我们只讨论了冒泡，因为捕获阶段很少被使用。通常我们看不到它。</strong></p>
<p>使用 <code>on&lt;event&gt;</code> 属性或使用 HTML 特性（attribute）或使用两个参数的 <code>addEventListener(event, handler)</code> 添加的处理程序，对捕获一无所知，它们仅在第二阶段和第三阶段运行。</p>
<p>为了在捕获阶段捕获事件，我们需要将处理程序的 <code>capture</code> 选项设置为 <code>true</code>：</p>
<div id="tvytyjcfqy" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>elem.addEventListener(..., {capture: true})
// 或者，用 {capture: true} 的别名 &quot;true&quot;
elem.addEventListener(..., true)</code></pre>
        </div>
      </div>
      
      </div><p><code>capture</code> 选项有两个可能的值：</p>
<ul>
<li>如果为 <code>false</code>（默认值），则在冒泡阶段设置处理程序。</li>
<li>如果为 <code>true</code>，则在捕获阶段设置处理程序。</li>
</ul>
<p>请注意，虽然形式上有 3 个阶段，但第 2 阶段（“目标阶段”：事件到达元素）没有被单独处理：捕获阶段和冒泡阶段的处理程序都在该阶段被触发。</p>
<p>让我们来看看捕获和冒泡：</p>
<div id="xn3n1yf4q3" data-trusted="1" class="code-example" data-demo-height="140" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="展示" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="在沙箱中打开" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code>&lt;style&gt;
  body * {
    margin: 10px;
    border: 1px solid blue;
  }
&lt;/style&gt;

&lt;form&gt;FORM
  &lt;div&gt;DIV
    &lt;p&gt;P&lt;/p&gt;
  &lt;/div&gt;
&lt;/form&gt;

&lt;script&gt;
  for(let elem of document.querySelectorAll('*')) {
    elem.addEventListener(&quot;click&quot;, e =&gt; alert(`Capturing: ${elem.tagName}`), true);
    elem.addEventListener(&quot;click&quot;, e =&gt; alert(`Bubbling: ${elem.tagName}`));
  }
&lt;/script&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
          <iframe class="code-result__iframe" name="test-xn3n1yf4q3" style="height:140px" src="about:blank"></iframe>
        </div>
      </div><p>上面这段代码为文档中的 <strong>每个</strong> 元素都设置了点击处理程序，以查看哪些元素上的点击事件处理程序生效了。</p>
<p>如果你点击了 <code>&lt;p&gt;</code>，那么顺序是：</p>
<ol>
<li><code>HTML</code> → <code>BODY</code> → <code>FORM</code> → <code>DIV</code>（捕获阶段第一个监听器）：</li>
<li><code>P</code>（目标阶段，触发两次，因为我们设置了两个监听器：捕获和冒泡）</li>
<li><code>DIV</code> → <code>FORM</code> → <code>BODY</code> → <code>HTML</code>（冒泡阶段，第二个监听器）。</li>
</ol>
<p>有一个属性 <code>event.eventPhase</code>，它告诉我们捕获事件的阶段数。但它很少被使用，因为我们通常是从处理程序中了解到它。</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">要移除处理程序，<code>removeEventListener</code> 需要同一阶段</span></div>
            <div class="important__content"><p>如果我们 <code>addEventListener(..., true)</code>，那么我们应该在 <code>removeEventListener(..., true)</code> 中提到同一阶段，以正确删除处理程序。</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">同一元素的同一阶段的监听器按其设置顺序运行</span></div>
            <div class="important__content"><p>如果我们在同一阶段有多个事件处理程序，并通过 <code>addEventListener</code> 分配给了相同的元素，则它们的运行顺序与创建顺序相同：</p>
<div id="13grj9tva3" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>elem.addEventListener(&quot;click&quot;, e =&gt; alert(1)); // 会先被触发
elem.addEventListener(&quot;click&quot;, e =&gt; alert(2));</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h2><a class="main__anchor" name="zong-jie" href="#zong-jie">总结</a></h2><p>当一个事件发生时 —— 发生该事件的嵌套最深的元素被标记为“目标元素”（<code>event.target</code>）。</p>
<ul>
<li>然后，事件从文档根节点向下移动到 <code>event.target</code>，并在途中调用分配了 <code>addEventListener(..., true)</code> 的处理程序（<code>true</code> 是 <code>{capture: true}</code> 的一个简写形式）。</li>
<li>然后，在目标元素自身上调用处理程序。</li>
<li>然后，事件从 <code>event.target</code> 冒泡到根，调用使用 <code>on&lt;event&gt;</code>、HTML 特性（attribute）和没有第三个参数的，或者第三个参数为 <code>false/{capture:false}</code> 的 <code>addEventListener</code> 分配的处理程序。</li>
</ul>
<p>每个处理程序都可以访问 <code>event</code> 对象的属性：</p>
<ul>
<li><code>event.target</code> —— 引发事件的层级最深的元素。</li>
<li><code>event.currentTarget</code>（=<code>this</code>）—— 处理事件的当前元素（具有处理程序的元素）</li>
<li><code>event.eventPhase</code> —— 当前阶段（capturing=1，target=2，bubbling=3）。</li>
</ul>
<p>任何事件处理程序都可以通过调用 <code>event.stopPropagation()</code> 来停止事件，但不建议这样做，因为我们不确定是否确实不需要冒泡上来的事件，也许是用于完全不同的事情。</p>
<p>捕获阶段很少使用，通常我们会在冒泡时处理事件。这背后有一个逻辑。</p>
<p>在现实世界中，当事故发生时，当地警方会首先做出反应。他们最了解发生这件事的地方。然后，如果需要，上级主管部门再进行处理。</p>
<p>事件处理程序也是如此。在特定元素上设置处理程序的代码，了解有关该元素最详尽的信息。特定于 <code>&lt;td&gt;</code> 的处理程序可能恰好适合于该 <code>&lt;td&gt;</code>，这个处理程序知道关于该元素的所有信息。所以该处理程序应该首先获得机会。然后，它的直接父元素也了解相关上下文，但了解的内容会少一些，以此类推，直到处理一般性概念并运行最后一个处理程序的最顶部的元素为止。</p>
<p>冒泡和捕获为“事件委托”奠定了基础 —— 一种非常强大的事件处理模式，我们将在下一章中进行研究。</p>
</div></article></div><div class="page__nav-wrap"><a class="page__nav page__nav_prev" href="../introduction-browser-events/index.html" data-tooltip="浏览器事件简介"><span class="page__nav-text"><span class="page__nav-text-shortcut"></span></span><span class="page__nav-text-alternate">上一节</span></a><a class="page__nav page__nav_next" href="../event-delegation/index.html" data-tooltip="事件委托"><span class="page__nav-text"><span class="page__nav-text-shortcut"></span></span><span class="page__nav-text-alternate">下一节</span></a></div><div class="article-tablet-foot tablet-only"><div class="article-tablet-foot__layout"><div class="share-icons"><span class="share-icons__title">分享</span><a class="share share_tw" href="https://twitter.com/share?url=https%3A%2F%2Fzh.javascript.info%2Fbubbling-and-capturing" rel="nofollow"></a><a class="share share_fb" href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=https%3A%2F%2Fzh.javascript.info%2Fbubbling-and-capturing" rel="nofollow"></a></div><div class="article-tablet-foot__map"><a class="map" href="../tutorial/map/index.html" data-action="tutorial-map"><span class="map__text">教程路线图</span></a></div></div></div><div class="comments formatted" id="comments"><div class="comments__header"><h2 class="comments__header-title"><a href="#comments" name="comments">评论</a></h2><div class="comments__read-before"><span class="comments__read-before-link">在评论之前先阅读本内容…</span><div class="comments__read-before-popup"><div class="comments__read-before-popup-i"><ul><li>如果你发现教程有错误，或者有其他需要修改和提升的地方 — 请 <a href="https://github.com/javascript-tutorial/zh.javascript.info/issues">提交一个 GitHub issue</a> 或 pull request，而不是在这评论。</li><li>如果你对教程的内容有不理解的地方 — 请详细说明。</li><li>使用 <code>&lt;code&gt;</code> 标签插入只有几个词的代码，插入多行代码可以使用 <code>&lt;pre&gt;</code> 标签，对于超过 10 行的代码，建议你使用沙箱（<a href="https://plnkr.co/edit/?p=preview">plnkr</a>，<a href="https://jsbin.com">JSBin</a>，<a href="http://codepen.io">codepen</a>…）</li></ul></div></div></div></div><div id="disqus_thread"></div><script>var disqus_config = function() { if (!this.page) this.page = {}; Object.assign(this.page, {"url":"https:\/\/zh.javascript.info\/bubbling-and-capturing","identifier":"\/bubbling-and-capturing"}); };</script><script>var disqus_shortname = "zh-javascript-info";</script><script>var disqus_enabled = true;</script></div></main></div><div class="sidebar page__sidebar sidebar sidebar_sticky-footer"><button class="sidebar__toggle" data-sidebar-toggle></button><a class="map" href="../tutorial/map/index.html" data-action="tutorial-map" data-tooltip="教程路线图"></a><div class="sidebar__inner"><div class="sidebar__content"><div class="sidebar__section"><h4 class="sidebar__section-title">章节</h4><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a class="sidebar__link" href="../events/index.html">事件简介</a></li></ul></nav></div><div class="sidebar__section"><h4 class="sidebar__section-title">课程导航</h4><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a class="sidebar__link" href="#mao-pao">冒泡</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#eventtarget">event.target</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#ting-zhi-mao-pao">停止冒泡</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#bu-huo">捕获</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#zong-jie">总结</a></li></ul></nav></div><div class="sidebar__section"><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a class="sidebar__link" href="#comments">评论</a></li></ul></nav></div><div class="sidebar__section"><div class="sidebar__section-title">分享</div><a class="share share_tw sidebar__share" href="https://twitter.com/share?url=https%3A%2F%2Fzh.javascript.info%2Fbubbling-and-capturing" rel="nofollow"></a><a class="share share_fb sidebar__share" href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p[url]=https%3A%2F%2Fzh.javascript.info%2Fbubbling-and-capturing" rel="nofollow"></a></div><div class="sidebar__section"><a class="sidebar__link" href="https://github.com/javascript-tutorial/zh.javascript.info/blob/master/2-ui/2-events/02-bubbling-and-capturing" rel="nofollow">在 GitHub 上编辑</a></div></div></div></div></div></div><div class="page-footer"><ul class="page-footer__list"><li class="page-footer__item page-footer__item_copy">©&nbsp;2007—2022&nbsp; Ilya Kantor</li><li class="page-footer__item page-footer__item_about"><a class="page-footer__link" href="../about/index.html">关于本项目</a></li><li class="page-footer__item page-footer__item_contact"><a class="page-footer__link" href="../about/index.html#contact-us">联系我们</a></li></ul></div></body></html>